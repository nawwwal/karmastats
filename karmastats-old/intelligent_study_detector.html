<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KARMASTAT - Intelligent Study Design Detector</title>
    <style>
        /* Enhanced CSS Variables */
        :root {
            --primary: #FF8C42;
            --primary-dark: #E67A2F;
            --primary-light: #FFB570;
            --secondary: #2C5282;
            --accent: #F6AD55;
            --success: #38A169;
            --warning: #D69E2E;
            --danger: #E53E3E;
            --info: #3182CE;
            
            /* Light theme colors */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F7FAFC;
            --bg-card: #FFFFFF;
            --text-primary: #2D3748;
            --text-secondary: #4A5568;
            --text-muted: #718096;
            --border-color: #E2E8F0;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.15);
            
            /* Enhanced gradients */
            --gradient-primary: linear-gradient(135deg, #FF8C42, #F6AD55, #FFB570);
            --gradient-secondary: linear-gradient(135deg, #2C5282, #3182CE, #4299E1);
            --gradient-bg: linear-gradient(135deg, #FFF5F0, #FEEBC8, #FED7AA);
            --gradient-card: linear-gradient(145deg, #FFFFFF, #F7FAFC);
            --gradient-magic: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font-main: 'Segoe UI', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --bg-primary: #1A202C;
            --bg-secondary: #2D3748;
            --bg-card: #2D3748;
            --text-primary: #F7FAFC;
            --text-secondary: #E2E8F0;
            --text-muted: #A0AEC0;
            --border-color: #4A5568;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 8px 20px rgba(0, 0, 0, 0.4);
            --gradient-bg: linear-gradient(135deg, #1A202C, #2D3748, #4A5568);
            --gradient-card: linear-gradient(145deg, #2D3748, #4A5568);
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-main);
            min-height: 100vh;
            background: var(--gradient-bg);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
            overflow-x: hidden;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* Header Design */
        .header {
            background: var(--gradient-card);
            border-radius: var(--radius);
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .header::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 140, 66, 0.03) 0%, transparent 70%);
            pointer-events: none;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            color: white;
            font-weight: 800;
            box-shadow: var(--shadow);
            position: relative;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            filter: blur(20px);
            opacity: 0.3;
            z-index: -1;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.75rem;
            letter-spacing: -0.02em;
        }

        .header .subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            font-weight: 500;
            max-width: 700px;
            margin: 0 auto;
        }

        .theme-toggle {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 0.75rem 1.25rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .theme-toggle:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        /* Main Analysis Section */
        .analysis-section {
            background: var(--gradient-card);
            border-radius: var(--radius);
            padding: 3rem;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            position: relative;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .section-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient-magic);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            box-shadow: var(--shadow);
            position: relative;
        }

        .section-icon::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 15px;
            background: inherit;
            filter: blur(15px);
            opacity: 0.4;
            z-index: -1;
        }

        .section-header h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Research Input Area */
        .research-input-container {
            margin-bottom: 2.5rem;
        }

        .input-label {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: block;
        }

        .research-input {
            width: 100%;
            min-height: 150px;
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 1.1rem;
            font-family: inherit;
            line-height: 1.6;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: var(--transition);
            resize: vertical;
        }

        .research-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 140, 66, 0.1);
            transform: translateY(-2px);
        }

        .input-help {
            font-size: 0.95rem;
            color: var(--text-muted);
            margin-top: 0.75rem;
            line-height: 1.5;
        }

        .analyze-button {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1.25rem 3rem;
            border-radius: var(--radius);
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 2rem auto 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .analyze-button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Analysis Progress */
        .analysis-progress {
            display: none;
            text-align: center;
            margin: 2rem 0;
            padding: 2rem;
            background: var(--bg-secondary);
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .progress-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border-color);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        .progress-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Results Section */
        .results-section {
            display: none;
            margin-top: 2rem;
        }

        .results-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .results-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .study-recommendations {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .study-card {
            background: var(--gradient-card);
            border: 2px solid var(--border-color);
            border-radius: var(--radius);
            padding: 2rem;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .study-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .study-card.recommended {
            border-color: var(--primary);
            background: linear-gradient(145deg, rgba(255, 140, 66, 0.05), var(--bg-card));
        }

        .study-card.recommended::before {
            content: '⭐ RECOMMENDED';
            position: absolute;
            top: 0;
            right: 0;
            background: var(--gradient-primary);
            color: white;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            font-weight: 700;
            border-bottom-left-radius: var(--radius);
        }

        .confidence-score {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--gradient-secondary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .study-card.recommended .confidence-score {
            top: 3rem;
        }

        .study-type {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            margin-top: 0.5rem;
        }

        .study-description {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .study-features {
            margin-bottom: 1.5rem;
        }

        .features-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .feature-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .feature-tag {
            background: var(--bg-secondary);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            border: 1px solid var(--border-color);
        }

        .reasoning-section {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .reasoning-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .reasoning-text {
            color: var(--text-secondary);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .detected-keywords {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .keyword-tag {
            background: var(--gradient-primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-hover);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 1rem 2rem;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }

        /* Analysis Summary */
        .analysis-summary {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 2rem;
            margin-top: 2rem;
        }

        .summary-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .summary-content {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Animations */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-in {
            animation: slideIn 0.6s ease-out;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .logo {
                flex-direction: column;
                gap: 1rem;
            }
            
            .theme-toggle {
                position: static;
                margin-top: 1rem;
                align-self: center;
            }
            
            .study-recommendations {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">K</div>
                    <div>
                        <h1>KARMASTAT</h1>
                        <p class="subtitle">Magical Epidemiological Study Design Detection & Analysis Platform</p>
                    </div>
                </div>
            </div>
            <div class="theme-toggle" id="themeToggle">
                <span id="themeIcon">🌙</span>
                <span id="themeText">Dark Mode</span>
            </div>
        </div>

        <!-- Main Analysis Section -->
        <div class="analysis-section">
            <div class="section-header">
                <div class="section-icon">🔮</div>
                <h2>Intelligent Study Design Detection</h2>
            </div>

            <div class="research-input-container">
                <label for="researchInput" class="input-label">
                    Describe Your Research Question or Study Objective
                </label>
                <textarea 
                    id="researchInput" 
                    class="research-input" 
                    placeholder="Please provide a detailed description of your research question, objectives, and methodology. For example:

'I want to investigate the prevalence of hypertension among adults aged 40-65 in urban areas of Delhi and examine its association with lifestyle factors including diet, physical activity, smoking status, and family history. The study aims to determine current disease burden and identify modifiable risk factors for prevention strategies.'

Or:

'I need to compare the effectiveness of two different surgical techniques for treating cardiac valve disease. Patients will be randomly assigned to either minimally invasive robotic surgery or traditional open-heart surgery, and we will measure outcomes including hospital stay duration, complications, and patient recovery time over 6 months follow-up.'

The more detail you provide about your research goals, population, methodology, and expected outcomes, the more accurate our study design recommendations will be."
                ></textarea>
                <div class="input-help">
                    Provide comprehensive details about your research goals, target population, variables of interest, and methodology preferences. Our advanced analysis engine will examine your text for key indicators to recommend the most appropriate epidemiological study design.
                </div>
            </div>

            <button class="analyze-button" id="analyzeButton">
                <span>🧠</span>
                Analyze & Detect Optimal Study Design
            </button>

            <!-- Analysis Progress -->
            <div class="analysis-progress" id="analysisProgress">
                <div class="progress-spinner"></div>
                <div class="progress-text">Analyzing research methodology and detecting optimal study design...</div>
            </div>

            <!-- Results Section -->
            <div class="results-section" id="resultsSection">
                <div class="results-header">
                    <h3 class="results-title">Study Design Recommendations</h3>
                    <p class="results-subtitle">Based on advanced analysis of your research objectives and methodology</p>
                </div>

                <div class="study-recommendations" id="studyRecommendations">
                    <!-- Study recommendations will be populated here -->
                </div>

                <div class="analysis-summary" id="analysisSummary">
                    <h4 class="summary-title">
                        <span>📊</span>
                        Analysis Summary
                    </h4>
                    <div class="summary-content" id="summaryContent">
                        <!-- Summary content will be populated here -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" id="proceedButton">
                        <span>🚀</span>
                        Proceed to Sample Size Calculator
                    </button>
                    <button class="btn-secondary" id="newAnalysisButton">
                        <span>🔄</span>
                        Analyze New Research Question
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class IntelligentStudyDetector {
            constructor() {
                this.currentTheme = 'light';
                this.detectedStudyTypes = [];
                this.analysisEngine = new AdvancedAnalysisEngine();
                this.init();
            }

            init() {
                console.log('🚀 Initializing Intelligent Study Detector...');
                this.setupEventListeners();
                this.loadSavedTheme();
                console.log('✅ Study Detector initialized successfully');
            }

            setupEventListeners() {
                // Theme toggle
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
                
                // Analysis button
                document.getElementById('analyzeButton').addEventListener('click', () => this.analyzeResearch());
                
                // Action buttons
                document.getElementById('proceedButton').addEventListener('click', () => this.proceedToCalculator());
                document.getElementById('newAnalysisButton').addEventListener('click', () => this.resetAnalysis());
            }

            toggleTheme() {
                this.currentTheme = this.currentTheme === 'light' ? 'dark' : 'light';
                document.body.setAttribute('data-theme', this.currentTheme);
                
                const themeIcon = document.getElementById('themeIcon');
                const themeText = document.getElementById('themeText');
                
                if (this.currentTheme === 'dark') {
                    themeIcon.textContent = '☀️';
                    themeText.textContent = 'Light Mode';
                } else {
                    themeIcon.textContent = '🌙';
                    themeText.textContent = 'Dark Mode';
                }
                
                localStorage.setItem('karmastat-theme', this.currentTheme);
            }

            loadSavedTheme() {
                const savedTheme = localStorage.getItem('karmastat-theme');
                if (savedTheme && savedTheme !== this.currentTheme) {
                    this.toggleTheme();
                }
            }

            async analyzeResearch() {
                const researchText = document.getElementById('researchInput').value.trim();
                
                if (!researchText || researchText.length < 50) {
                    alert('Please provide a more detailed description of your research question (minimum 50 characters).');
                    return;
                }

                const analyzeButton = document.getElementById('analyzeButton');
                const analysisProgress = document.getElementById('analysisProgress');
                const resultsSection = document.getElementById('resultsSection');

                // Show loading state
                analyzeButton.disabled = true;
                analysisProgress.style.display = 'block';
                resultsSection.style.display = 'none';

                try {
                    // Simulate processing time for realistic experience
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // Perform advanced analysis
                    const analysisResults = this.analysisEngine.analyzeResearchText(researchText);
                    
                    // Display results
                    this.displayResults(analysisResults);
                    
                    // Show results section
                    analysisProgress.style.display = 'none';
                    resultsSection.style.display = 'block';
                    resultsSection.classList.add('slide-in');
                    
                    // Scroll to results
                    resultsSection.scrollIntoView({ behavior: 'smooth' });
                    
                } catch (error) {
                    console.error('Analysis error:', error);
                    alert('Error analyzing research text. Please try again.');
                } finally {
                    analyzeButton.disabled = false;
                }
            }

            displayResults(results) {
                this.detectedStudyTypes = results.recommendations;
                
                const recommendationsContainer = document.getElementById('studyRecommendations');
                const summaryContent = document.getElementById('summaryContent');
                
                // Clear previous results
                recommendationsContainer.innerHTML = '';
                
                // Display study recommendations
                results.recommendations.forEach((study, index) => {
                    const studyCard = this.createStudyCard(study, index === 0);
                    recommendationsContainer.appendChild(studyCard);
                });
                
                // Display analysis summary
                summaryContent.innerHTML = this.generateAnalysisSummary(results);
            }

            createStudyCard(study, isRecommended) {
                const card = document.createElement('div');
                card.className = `study-card ${isRecommended ? 'recommended' : ''}`;
                card.dataset.studyType = study.type;
                
                card.innerHTML = `
                    <div class="confidence-score">${study.confidence}% Match</div>
                    <h3 class="study-type">${study.title}</h3>
                    <p class="study-description">${study.description}</p>
                    
                    <div class="study-features">
                        <div class="features-title">Key Characteristics:</div>
                        <div class="feature-list">
                            ${study.features.map(feature => `<span class="feature-tag">${feature}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div class="reasoning-section">
                        <div class="reasoning-title">
                            <span>🎯</span>
                            Why This Design?
                        </div>
                        <div class="reasoning-text">${study.reasoning}</div>
                        ${study.detectedKeywords && study.detectedKeywords.length > 0 ? `
                            <div class="detected-keywords">
                                ${study.detectedKeywords.map(keyword => `<span class="keyword-tag">${keyword}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
                
                return card;
            }

            generateAnalysisSummary(results) {
                const topRecommendation = results.recommendations[0];
                const totalKeywords = results.keywordAnalysis.totalDetected;
                const analysisDepth = results.analysisDepth;
                
                return `
                    <p><strong>Primary Recommendation:</strong> ${topRecommendation.title} with ${topRecommendation.confidence}% confidence match based on analysis of your research objectives.</p>
                    
                    <p><strong>Analysis Depth:</strong> Our system detected ${totalKeywords} relevant methodological keywords and analyzed ${analysisDepth} distinct research design indicators from your description.</p>
                    
                    <p><strong>Key Factors Considered:</strong> Research objectives, target population characteristics, data collection methodology, temporal considerations, outcome measurement approaches, and feasibility constraints.</p>
                    
                    ${results.recommendations.length > 1 ? `
                        <p><strong>Alternative Options:</strong> ${results.recommendations.length - 1} additional study design${results.recommendations.length > 2 ? 's' : ''} identified as potentially suitable for your research question with varying confidence levels.</p>
                    ` : ''}
                `;
            }

            proceedToCalculator() {
                const recommendedStudy = this.detectedStudyTypes[0];
                if (recommendedStudy) {
                    // Store the recommendation in localStorage for the calculator
                    localStorage.setItem('karmastat-selected-study', JSON.stringify(recommendedStudy));
                    
                    // Navigate to appropriate calculator
                    switch (recommendedStudy.type) {
                        case 'cross-sectional':
                            window.location.href = 'karmastat-cross-sectional.html';
                            break;
                        case 'case-control':
                            window.location.href = 'karmastat-case-control.html';
                            break;
                        case 'cohort':
                            window.location.href = 'karmastat-cohort.html';
                            break;
                        case 'clinical-trial':
                            window.location.href = 'karmastat-clinical-trial.html';
                            break;
                        case 'diagnostic':
                            window.location.href = 'karmastat-diagnostic.html';
                            break;
                        default:
                            window.location.href = 'karmastat-cross-sectional.html';
                    }
                } else {
                    alert('Please analyze your research question first.');
                }
            }

            resetAnalysis() {
                document.getElementById('researchInput').value = '';
                document.getElementById('resultsSection').style.display = 'none';
                document.getElementById('researchInput').focus();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        class AdvancedAnalysisEngine {
            constructor() {
                this.studyTypePatterns = this.initializePatterns();
                this.keywordWeights = this.initializeKeywordWeights();
            }

            initializePatterns() {
                return {
                    'cross-sectional': {
                        primary: ['prevalence', 'proportion', 'frequency', 'distribution', 'snapshot', 'point in time', 'current status', 'burden of disease'],
                        secondary: ['survey', 'questionnaire', 'cross-sectional', 'descriptive', 'epidemiological survey'],
                        context: ['at a specific time', 'current state', 'existing cases', 'disease burden', 'health status'],
                        negative: ['follow-up', 'longitudinal', 'intervention', 'randomized', 'control group']
                    },
                    'case-control': {
                        primary: ['risk factors', 'cause', 'etiology', 'odds ratio', 'exposure', 'cases and controls', 'retrospective'],
                        secondary: ['risk assessment', 'causal relationship', 'past exposure', 'case-control', 'matched controls'],
                        context: ['compare cases', 'exposed vs unexposed', 'retrospective analysis', 'disease causation'],
                        negative: ['prevalence', 'incidence rate', 'randomized', 'intervention']
                    },
                    'cohort': {
                        primary: ['follow-up', 'longitudinal', 'incidence', 'relative risk', 'prospective', 'outcome over time'],
                        secondary: ['cohort study', 'time to event', 'survival analysis', 'repeated measures', 'natural history'],
                        context: ['over time', 'follow patients', 'development of disease', 'temporal relationship'],
                        negative: ['prevalence', 'cross-sectional', 'intervention', 'randomized']
                    },
                    'clinical-trial': {
                        primary: ['treatment', 'intervention', 'randomized', 'efficacy', 'effectiveness', 'trial', 'therapy'],
                        secondary: ['clinical trial', 'controlled trial', 'randomization', 'placebo', 'treatment group', 'experimental'],
                        context: ['compare treatments', 'intervention effect', 'therapeutic benefit', 'clinical effectiveness'],
                        negative: ['observational', 'descriptive', 'prevalence', 'retrospective']
                    },
                    'diagnostic': {
                        primary: ['sensitivity', 'specificity', 'diagnostic test', 'accuracy', 'screening', 'detection'],
                        secondary: ['test performance', 'diagnostic accuracy', 'screening tool', 'biomarker', 'predictive value'],
                        context: ['test validity', 'diagnostic performance', 'screening program', 'test evaluation'],
                        negative: ['treatment', 'intervention', 'follow-up', 'incidence']
                    }
                };
            }

            initializeKeywordWeights() {
                return {
                    primary: 3.0,
                    secondary: 2.0,
                    context: 1.5,
                    negative: -2.0
                };
            }

            analyzeResearchText(text) {
                const normalizedText = text.toLowerCase();
                const words = normalizedText.split(/\s+/);
                
                const studyScores = {};
                const detectedKeywords = {};
                let totalKeywordsDetected = 0;

                // Initialize scores
                Object.keys(this.studyTypePatterns).forEach(studyType => {
                    studyScores[studyType] = 0;
                    detectedKeywords[studyType] = [];
                });

                // Analyze each study type
                Object.entries(this.studyTypePatterns).forEach(([studyType, patterns]) => {
                    Object.entries(patterns).forEach(([category, keywords]) => {
                        keywords.forEach(keyword => {
                            if (normalizedText.includes(keyword)) {
                                const weight = this.keywordWeights[category] || 1;
                                studyScores[studyType] += weight;
                                
                                if (weight > 0) {
                                    detectedKeywords[studyType].push(keyword);
                                    totalKeywordsDetected++;
                                }
                            }
                        });
                    });
                });

                // Advanced contextual analysis
                this.performContextualAnalysis(normalizedText, studyScores);

                // Generate recommendations
                const recommendations = this.generateRecommendations(studyScores, detectedKeywords, normalizedText);

                return {
                    recommendations,
                    keywordAnalysis: {
                        totalDetected: totalKeywordsDetected,
                        byStudyType: detectedKeywords
                    },
                    analysisDepth: Object.keys(this.studyTypePatterns).length,
                    rawScores: studyScores
                };
            }

            performContextualAnalysis(text, scores) {
                // Time-related analysis
                const timeIndicators = {
                    'cross-sectional': ['at the time', 'current', 'present', 'now', 'today'],
                    'cohort': ['over time', 'during', 'follow', 'months', 'years', 'period'],
                    'case-control': ['history', 'past', 'previous', 'before', 'prior'],
                    'clinical-trial': ['duration', 'treatment period', 'trial period']
                };

                Object.entries(timeIndicators).forEach(([studyType, indicators]) => {
                    indicators.forEach(indicator => {
                        if (text.includes(indicator)) {
                            scores[studyType] += 1.0;
                        }
                    });
                });

                // Population analysis
                if (text.includes('population') || text.includes('community')) {
                    scores['cross-sectional'] += 1.5;
                }

                if (text.includes('patients') || text.includes('clinical')) {
                    scores['clinical-trial'] += 1.0;
                    scores['case-control'] += 0.5;
                }

                // Outcome analysis
                if (text.includes('compare') || text.includes('comparison')) {
                    scores['clinical-trial'] += 2.0;
                    scores['case-control'] += 1.5;
                    scores['cohort'] += 1.0;
                }

                if (text.includes('measure') || text.includes('assess')) {
                    scores['cross-sectional'] += 1.0;
                    scores['diagnostic'] += 1.5;
                }
            }

            generateRecommendations(scores, detectedKeywords, text) {
                const studyTypes = {
                    'cross-sectional': {
                        title: 'Cross-Sectional Study',
                        description: 'Ideal for measuring prevalence, distribution, and associations of health conditions at a specific point in time.',
                        features: ['Prevalence estimation', 'Snapshot analysis', 'Cost-effective', 'Quick implementation', 'Population health assessment']
                    },
                    'case-control': {
                        title: 'Case-Control Study',
                        description: 'Excellent for investigating risk factors, causes, and associations with disease outcomes in a retrospective manner.',
                        features: ['Risk factor analysis', 'Odds ratio calculation', 'Efficient for rare diseases', 'Retrospective design', 'Causal inference']
                    },
                    'cohort': {
                        title: 'Cohort Study',
                        description: 'Perfect for studying disease incidence, natural history, and following subjects over time to observe outcomes.',
                        features: ['Incidence calculation', 'Temporal relationships', 'Multiple outcomes', 'Strong evidence level', 'Natural history']
                    },
                    'clinical-trial': {
                        title: 'Clinical Trial',
                        description: 'The gold standard for evaluating treatment effectiveness, interventions, and therapeutic approaches.',
                        features: ['Treatment evaluation', 'Randomized design', 'Causal inference', 'High evidence quality', 'Intervention testing']
                    },
                    'diagnostic': {
                        title: 'Diagnostic Accuracy Study',
                        description: 'Designed to evaluate the performance, accuracy, and clinical utility of diagnostic tests or screening tools.',
                        features: ['Test validation', 'Sensitivity/Specificity', 'Screening evaluation', 'Biomarker assessment', 'Clinical utility']
                    }
                };

                // Sort by score
                const sortedStudies = Object.entries(scores)
                    .sort(([,a], [,b]) => b - a)
                    .filter(([,score]) => score > 0);

                const recommendations = sortedStudies.map(([studyType, score]) => {
                    const baseInfo = studyTypes[studyType];
                    const confidence = Math.min(95, Math.max(50, Math.round((score / 10) * 100)));
                    
                    return {
                        type: studyType,
                        title: baseInfo.title,
                        description: baseInfo.description,
                        features: baseInfo.features,
                        confidence: confidence,
                        score: score,
                        detectedKeywords: detectedKeywords[studyType],
                        reasoning: this.generateReasoning(studyType, detectedKeywords[studyType], text)
                    };
                });

                // Ensure at least one recommendation
                if (recommendations.length === 0) {
                    recommendations.push({
                        type: 'cross-sectional',
                        title: 'Cross-Sectional Study',
                        description: 'Recommended as a suitable starting point for exploratory research.',
                        features: ['Prevalence estimation', 'Snapshot analysis', 'Cost-effective', 'Quick implementation'],
                        confidence: 65,
                        score: 0,
                        detectedKeywords: [],
                        reasoning: 'Based on general research characteristics, a cross-sectional design provides a practical approach for initial investigation.'
                    });
                }

                return recommendations;
            }

            generateReasoning(studyType, keywords, text) {
                const reasoningTemplates = {
                    'cross-sectional': 'Your research focuses on measuring current status and distribution patterns, making cross-sectional design ideal for prevalence estimation and snapshot analysis.',
                    'case-control': 'The emphasis on risk factors and causal relationships suggests a retrospective approach comparing cases with controls would be most effective.',
                    'cohort': 'Your study involves following subjects over time to observe outcomes, which aligns perfectly with cohort study methodology.',
                    'clinical-trial': 'The focus on intervention evaluation and treatment comparison indicates a randomized controlled trial design would provide the strongest evidence.',
                    'diagnostic': 'Your research centers on test performance and diagnostic accuracy, requiring a diagnostic study design to properly evaluate test characteristics.'
                };

                let reasoning = reasoningTemplates[studyType] || 'This study design matches your research objectives and methodology.';
                
                if (keywords.length > 0) {
                    reasoning += ` Key indicators detected: ${keywords.slice(0, 3).join(', ')}.`;
                }

                return reasoning;
            }
        }

        // Initialize the detector
        const studyDetector = new IntelligentStudyDetector();
    </script>
</body>
</html>
