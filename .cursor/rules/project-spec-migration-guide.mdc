---
description:
globs:
alwaysApply: true
---
---

name: Karmastat Next.js Migration Spec
route: /docs/karmastat-migration
--------------------------------

import Callout from '@/components/Callout'

# KARMASTAT â€” Next.jsÂ 15 App Router Migration âœ¨

<Callout type="info">
  All **legacy HTML calculators** live in the repo at **`/karmastats-old/`**. Treat that folder as readâ€‘only reference code: lift the maths, replace the markup.
</Callout>

## 0.Â Why this document exists

Unify all siloed HTML tools into **one opinionâ€‘ated, maintainable Next.js application** that shares brand, UX, and code, while preserving every statistical function.

---

## 1.Â Scope & Nonâ€‘Goals

|                                         | In Scope | Out of Scope     |
| --------------------------------------- | -------- | ---------------- |
| Port JS formulas (TypeScript wrappers)  | âœ…        |                  |
| Shared UI system (Tailwind + shadcn/ui) | âœ…        |                  |
| SSR/DB/Auth                             |          | âŒ not needed yet |
| Unit tests for calculators              | âœ…        |                  |
| Visual polish & brand tokens            | âœ…        |                  |

---

## 2.Â Project Folder Layout (proposed)

```txt
/karmastat        # âœ¨ new Next.js 15 project root
â”‚
â”œâ”€ app            # App Router pages/layouts
â”‚  â”œâ”€ (site)      # Public routes
â”‚  â”‚  â”œâ”€ page.tsx # Home (mission statement)
â”‚  â”‚  â””â”€ ...      # each module folder below
â”‚  â””â”€ (calc)      # Segmented routes for calculators
â”‚     â”œâ”€ disease-math/+page.tsx
â”‚     â”œâ”€ sampleâ€‘size/+layout.tsx
â”‚     â”œâ”€ sampleâ€‘size/â€¦           # subâ€‘routes 1.2.1â€‘1.2.7
â”‚     â””â”€ regression/+page.tsx
â”‚
â”œâ”€ lib            # Pure TS utilities â€” math lifted from /karmastats-old
â”‚  â”œâ”€ infectious.ts
â”‚  â”œâ”€ sampleSize.ts
â”‚  â””â”€ â€¦
â”‚
â”œâ”€ components     # Presentational React (stateless)
â”œâ”€ ui             # shadcn/ui reâ€‘exports + custom tokens
â”œâ”€ styles         # tailwind.config, globals.css
â””â”€ tests          # vitest + testingâ€‘library/react

/karmastats-old   # ðŸ“¦ legacy HTML files (unchanged)
```

---

## 3.Â Routing & Navigation Map

```mermaid
flowchart TD
  home((Home)) --> idm[Infectious Disease]
  home --> ssc[Sample Size]
  home --> reg[Regression]
  home --> fam[Family Study]

  ssc --> ist(Intelligent Study Detector)
  ssc --> surv(Survival Analysis)
  ssc --> comp(Comparative Study)
  ssc --> ttest(Tâ€‘Test)
  ssc --> diag(Diagnostic Study)
  ssc --> ct(Clinical Trials)
  ssc --> desc(Crossâ€‘sectional / Descriptive)
```

---

## 4.Â Brand & UI Tokens (Tailwind preset)

```ts
export const karmaTheme = {
  primary: '#146C94',
  secondary: '#19A7CE',
  accent: '#F8FDCF',
  neutral: '#F6F1F1',
}
```

* Use **Inter** for text, **Space Mono** for code/math.
* Shared `<CalcCard>` component for each calculator landing tile.

---

## 5.Â Porting Workflow

1. **Audit** each HTML file in `/karmastats-old` â€“ isolate pure math JS.
2. **Wrap** formulas into named TS functions inside `lib/` with JSDoc + unit tests.
3. **Replace** HTML UI with React components using shadcn/ui primitives.
4. **Connect** input fields to math via Zodâ€‘validated forms.
5. **Snapshot tests** to guard regressions.

---

## 6.Â Tooling

* **Next.jsÂ 15** (App Router, ReactÂ 19, Turbopack)
* **TypeScriptÂ 5.4**
* **TailwindÂ 4 + shadcn/ui**
* **Zod** for runtime validation
* **Vitest** + **Testing Library** for unit/UI tests

---

## 7.Â Milestones & Estimates

| Phase     | Task                         | Owner | Est.      |
| --------- | ---------------------------- | ----- | --------- |
| 1         | Repo bootstrap + CI          | you   | 0.5Â d     |
| 2         | Infectious Disease port      | you   | 1Â d       |
| 3         | Sample Size shell + detector | you   | 1.5Â d     |
| 4         | Remaining 6 calc pages       | you   | 3Â d       |
| 5         | Regression & Family Study    | you   | 1.5Â d     |
| 6         | Visual QA & tests            | you   | 1Â d       |
| **Total** |                              |       | **8â€‘9 d** |
