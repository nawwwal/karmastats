---
description:
globs:
alwaysApply: true
---
# KARMASTAT â€” Next.js 15 App Router Migration âœ¨

## 0. Why this document exists

Unify all siloed HTML tools into **one opinionâ€‘ated, maintainable Next.js application** that shares brand, UX, and code, while preserving every statistical function.

---

## 1. Migration Status & Audit Tracker

| Calculator Module        | Legacy File(s)                                | New Lib/Component                            | Status                | Notes                                                                                             |
| ------------------------ | --------------------------------------------- | -------------------------------------------- | --------------------- | ------------------------------------------------------------------------------------------------- |
| **Infectious Disease**   | `advanced-disease-model.html`                 | `lib/infectious.ts`, `components/disease-math/` | âœ… Complete            | Refactored to full SEIRDV model. UI and logic now in sync.                                        |
| **Regression**           | `REGRESSION CALCULATOR.html`                  | `lib/regression.ts`, `components/regression/`   | âœ… Complete            | Backend logic ported (Linear, Poly, Logistic). UI components created for all regression types.    |
| **Sample Size**          |                                               |                                              | ðŸŸ¡ In Progress         | This is a group of 7 calculators. Layout created.                                                 |
| â”œâ”€ Study Detector       | `intelligent_study_detector.html`             | `lib/studyDetector.ts`                       | âœ… Complete            | UI and logic ported.                                                                              |
| â”œâ”€ Survival Analysis    | `karmastat_survival_analysis.html`            | `lib/survivalAnalysis.ts`                    | âœ… Complete            | UI and logic ported for all 3 modes.                                                              |
| â”œâ”€ Comparative Study    | `karmastat_comparative_fixed.html`            | `lib/comparativeStudy.ts`                    | âœ… Complete            | UI and logic ported for Case-Control and Cohort studies.                                          |
| â”œâ”€ T-Test                | `karmastat_basic_tests.html`                  | `lib/math/sample-size/tTest.ts`              | âœ… Complete            | Core logic and UI ported. PDF features pending.                                                   |
| â”œâ”€ Diagnostic Study     | `karmastat_diagnostic_calculator (1).html`    | `lib/diagnosticTest.ts`                      | âœ… Complete            | UI and logic ported for all 3 modes (Single, Comparative, ROC). Missing PDF features.             |
| â”œâ”€ Clinical Trials      | `karmastat_clinical_trials CALC.html`         | `lib/clinicalTrial.ts`                       | âœ… Complete            | UI and logic ported for all 3 modes (Superiority, Non-Inferiority, Equivalence). Missing PDF features. |
| â”œâ”€ Cross-sectional     | `enhanced_cross_sectional_calculator.html`    | `lib/crossSectional.ts`                      | âœ… Complete            | UI and logic ported with advanced options. Missing PDF features.                                  |
| **Family Study**         | *Not found in legacy files*                   | `app/(calc)/family-study/`                   | â“ Blocked             | No clear legacy file. Needs clarification.                                                        |
| **CMD-OPD**              | `cmd-opd/`                                    | *Not found in new structure*                 | â“ Blocked             | Legacy folder exists, but not in scope/map. Needs clarification.                                  |

---

## 2. Scope & Nonâ€‘Goals

|                                         | In Scope | Out of Scope     |
| --- | ----- | ---- |
| Port JS formulas (TypeScript wrappers)  | âœ…        |                  |
| Shared UI system (Tailwind + shadcn/ui) | âœ…        |                  |
| SSR/DB/Auth                             |          | âŒ not needed yet |
| Unit tests for calculators              | âœ…        |                  |
| Visual polish & brand tokens            | âœ…        |                  |

---

## 3. Project Folder Layout (proposed)

```txt
/karmastat        # âœ¨ new Next.js 15 project root
â”‚
â”œâ”€ app            # App Router pages/layouts
â”‚  â”œâ”€ (site)      # Public routes
â”‚  â”‚  â”œâ”€ page.tsx # Home (mission statement)
â”‚  â”‚  â””â”€ ...      # each module folder below
â”‚  â””â”€ (calc)      # Segmented routes for calculators
â”‚     â”œâ”€ disease-math/+page.tsx
â”‚     â”œâ”€ sampleâ€‘size/+layout.tsx
â”‚     â”œâ”€ sampleâ€‘size/â€¦           # subâ€‘routes 1.2.1â€‘1.2.7
â”‚     â””â”€ regression/+page.tsx
â”‚
â”œâ”€ lib            # Pure TS utilities â€” math lifted from /karmastats-old
â”‚  â”œâ”€ infectious.ts
â”‚  â”œâ”€ sampleSize.ts
â”‚  â””â”€ â€¦
â”‚
â”œâ”€ components     # Presentational React (stateless)
â”œâ”€ ui             # shadcn/ui reâ€‘exports + custom tokens
â”œâ”€ styles         # tailwind.config, globals.css
â””â”€ tests          # vitest + testingâ€‘library/react

/karmastats-old   # ðŸ“¦ legacy HTML files (unchanged)
```

---

## 4. Routing & Navigation Map

```mermaid
flowchart TD
  home((Home)) --> idm[Infectious Disease]
  home --> ssc[Sample Size]
  home --> reg[Regression]
  home --> fam[Family Study]

  ssc --> ist(Intelligent Study Detector)
  ssc --> surv(Survival Analysis)
  ssc --> comp(Comparative Study)
  ssc --> ttest(Tâ€‘Test)
  ssc --> diag(Diagnostic Study)
  ssc --> ct(Clinical Trials)
  ssc --> desc(Crossâ€‘sectional / Descriptive)
```

---

## 5. Brand & UI Tokens (Tailwind preset)

```ts
export const karmaTheme = {
  primary: '#146C94',
  secondary: '#19A7CE',
  accent: '#F8FDCF',
  neutral: '#F6F1F1',
}
```

* Use **Inter** for text, **Space Mono** for code/math.
* Shared `<CalcCard>` component for each calculator landing tile.

---

## 6. Porting Workflow

1. **Audit** each HTML file in `/karmastats-old` â€“ isolate pure math JS.
2. **Wrap** formulas into named TS functions inside `lib/` with JSDoc + unit tests.
3. **Replace** HTML UI with React components using shadcn/ui primitives.
4. **Connect** input fields to math via Zodâ€‘validated forms.
5. **Snapshot tests** to guard regressions.

---

## 7. Tooling

* **Next.js 15** (App Router, React 19, Turbopack)
* **TypeScript 5.4**
* **Tailwind 4 + shadcn/ui**
* **Zod** for runtime validation
* **Vitest** + **Testing Library** for unit/UI tests

---

## 8. Milestones & Estimates

| Phase     | Task                         | Owner | Est.      |
| --- | ---- | ----- | --- |
| 1         | Repo bootstrap + CI          | you   | 0.5 d     |
| 2         | Infectious Disease port      | you   | 1 d       |
| 3         | Sample Size shell + detector | you   | 1.5 d     |
| 4         | Remaining 6 calc pages       | you   | 3 d       |
| 5         | Regression & Family Study    | you   | 1.5 d     |
| 6         | Visual QA & tests            | you   | 1 d       |
| **Total** |                              |       | **8â€‘9 d** |
